function Promise() {
  var complete = false;
  var complete_callback = undefined

  function complete(data) {
    complete = true;
    complete_callback(data) if complete_callback? 
  }

  function onComplete(callback) {
    complete_callback = callback;

    // if already completed
    complete_callback() if complete
  }


  function when(promises...) {
    var promise = new Promise()
    var counter = promises.length
    var data    = new Array(promises).length 

    for promise, i in promises
      promise.onComplete(function(data) {
        counter--;
        data[i] = data;

        if (counter == 0) {
          promise.complete(data);
        }
      });


    return promise

  }
}


function getUrl(url) {
// async call
  var promise = new Promise();

  // execute when done
  function callback(data) {
    promise.complete(data);
  }
return new Promise;
}



var promise1 = getUrl("http://google.com");
var promise2 = getUrl("http://foo.com");

promise1.onComplete(function(data) {

})

promise2.onComplete(function(data) {
})


